(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{5802:function(e,t,r){Promise.resolve().then(r.bind(r,5057)),Promise.resolve().then(r.t.bind(r,3925,23)),Promise.resolve().then(r.t.bind(r,2853,23))},5057:function(e,t,r){"use strict";r.r(t),r.d(t,{AuthProvider:function(){return AuthProvider},useAuth:function(){return useAuth}});var a=r(7437),s=r(2265),i=r(1492),n=r(3082);(0,i.eI)("https://placeholder.supabase.co","placeholder-key",{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0}});let createSupabaseClient=()=>(0,n.createClientComponentClient)();function convertDbUserProfile(e){return{id:e.id,first_name:e.first_name||void 0,last_name:e.last_name||void 0,phone:e.phone||void 0,role:e.role||"guest",avatar_url:e.avatar_url||void 0,preferences:e.preferences||{},created_at:e.created_at,updated_at:e.updated_at}}let AuthService=class AuthService{async signUp(e){let{email:t,password:r,firstName:a,lastName:s,phone:i,role:n="guest"}=e,{data:o,error:u}=await this.supabase.auth.signUp({email:t,password:r,options:{data:{first_name:a,last_name:s,phone:i,role:n}}});if(u)throw Error(u.message);return o}async signIn(e){let{email:t,password:r}=e,{data:a,error:s}=await this.supabase.auth.signInWithPassword({email:t,password:r});if(s)throw Error(s.message);return a}async signInWithProvider(e){let{data:t,error:r}=await this.supabase.auth.signInWithOAuth({provider:e,options:{redirectTo:"".concat(window.location.origin,"/auth/callback")}});if(r)throw Error(r.message);return t}async signOut(){let{error:e}=await this.supabase.auth.signOut();if(e)throw Error(e.message)}async getCurrentUser(){let{data:{user:e},error:t}=await this.supabase.auth.getUser();if(t||!e)return null;let{data:r}=await this.supabase.from("user_profiles").select("*").eq("id",e.id).single();return{id:e.id,email:e.email,profile:r?convertDbUserProfile(r):void 0}}async updateProfile(e,t){let{data:r,error:a}=await this.supabase.from("user_profiles").update(t).eq("id",e).select().single();if(a)throw Error(a.message);return r?convertDbUserProfile(r):null}async resetPassword(e){let{error:t}=await this.supabase.auth.resetPasswordForEmail(e,{redirectTo:"".concat(window.location.origin,"/auth/reset-password")});if(t)throw Error(t.message)}async updatePassword(e){let{error:t}=await this.supabase.auth.updateUser({password:e});if(t)throw Error(t.message)}onAuthStateChange(e){return this.supabase.auth.onAuthStateChange(async(t,r)=>{if(null==r?void 0:r.user){let t=await this.getCurrentUser();e(t)}else e(null)})}constructor(){this.supabase=createSupabaseClient()}};let o=new AuthService,u=(0,s.createContext)(void 0);function AuthProvider(e){let{children:t}=e,[r,i]=(0,s.useState)(null),[n,l]=(0,s.useState)(!0);(0,s.useEffect)(()=>{o.getCurrentUser().then(i).finally(()=>l(!1));let{data:{subscription:e}}=o.onAuthStateChange(e=>{i(e),l(!1)});return()=>e.unsubscribe()},[]);let signIn=async(e,t)=>{l(!0);try{await o.signIn({email:e,password:t});let r=await o.getCurrentUser();i(r)}catch(e){throw e}finally{l(!1)}},signUp=async e=>{l(!0);try{await o.signUp(e)}catch(e){throw e}finally{l(!1)}},signInWithProvider=async e=>{l(!0);try{await o.signInWithProvider(e)}catch(e){throw e}finally{l(!1)}},signOut=async()=>{l(!0);try{await o.signOut(),i(null)}catch(e){throw e}finally{l(!1)}},updateProfile=async e=>{if(!r)throw Error("No user logged in");try{let t=await o.updateProfile(r.id,e);t&&i({...r,profile:t})}catch(e){throw e}},resetPassword=async e=>{await o.resetPassword(e)};return(0,a.jsx)(u.Provider,{value:{user:r,loading:n,signIn,signUp,signInWithProvider,signOut,updateProfile,resetPassword},children:t})}function useAuth(){let e=(0,s.useContext)(u);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},2853:function(){},3925:function(e){e.exports={style:{fontFamily:"'__Inter_e8ce0c', '__Inter_Fallback_e8ce0c'",fontStyle:"normal"},className:"__className_e8ce0c"}}},function(e){e.O(0,[881,971,472,744],function(){return e(e.s=5802)}),_N_E=e.O()}]);