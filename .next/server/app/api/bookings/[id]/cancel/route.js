"use strict";(()=>{var e={};e.id=446,e.ids=[446],e.modules={2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},2361:e=>{e.exports=require("events")},3685:e=>{e.exports=require("http")},5687:e=>{e.exports=require("https")},1808:e=>{e.exports=require("net")},5477:e=>{e.exports=require("punycode")},2781:e=>{e.exports=require("stream")},4404:e=>{e.exports=require("tls")},7310:e=>{e.exports=require("url")},9796:e=>{e.exports=require("zlib")},1608:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>g,originalPathname:()=>m,requestAsyncStorage:()=>d,routeModule:()=>c,serverHooks:()=>l,staticGenerationAsyncStorage:()=>p,staticGenerationBailout:()=>x});var o={};t.r(o),t.d(o,{POST:()=>POST});var s=t(884),i=t(6132),n=t(5798),a=t(699),u=t(4598);async function POST(e,{params:r}){try{let e=(0,a.j)(),{data:{user:t},error:o}=await e.auth.getUser();if(o||!t)return n.Z.json({error:{code:"UNAUTHORIZED",message:"Authentication required"}},{status:401});let s=await u.s.getBookingById(r.id);if(!s)return n.Z.json({error:{code:"NOT_FOUND",message:"Booking not found"}},{status:404});let{data:i}=await e.from("user_profiles").select("role").eq("id",t.id).single(),c=!1;if(i?.role==="admin")c=!0;else if(i?.role==="owner"){let{data:r}=await e.from("properties").select("owner_id").eq("id",s.property_id).single();c=r?.owner_id===t.id}else i?.role==="guest"&&(c=s.guest_id===t.id);if(!c)return n.Z.json({error:{code:"FORBIDDEN",message:"Access denied"}},{status:403});let d=await u.s.cancelBooking(r.id);return n.Z.json({data:d})}catch(e){if(console.error("Error cancelling booking:",e),e instanceof Error)return n.Z.json({error:{code:"BOOKING_ERROR",message:e.message}},{status:400});return n.Z.json({error:{code:"INTERNAL_ERROR",message:"Failed to cancel booking"}},{status:500})}}let c=new s.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/bookings/[id]/cancel/route",pathname:"/api/bookings/[id]/cancel",filename:"route",bundlePath:"app/api/bookings/[id]/cancel/route"},resolvedPagePath:"/Users/emmanuelbukenya/Projects/Medical Rentals/medical-rentals/app/api/bookings/[id]/cancel/route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:d,staticGenerationAsyncStorage:p,serverHooks:l,headerHooks:g,staticGenerationBailout:x}=c,m="/api/bookings/[id]/cancel/route"}};var r=require("../../../../../webpack-runtime.js");r.C(e);var __webpack_exec__=e=>r(r.s=e),t=r.X(0,[657,736,937],()=>__webpack_exec__(1608));module.exports=t})();