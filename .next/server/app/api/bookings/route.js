"use strict";(()=>{var e={};e.id=946,e.ids=[946],e.modules={2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},2361:e=>{e.exports=require("events")},3685:e=>{e.exports=require("http")},5687:e=>{e.exports=require("https")},1808:e=>{e.exports=require("net")},5477:e=>{e.exports=require("punycode")},2781:e=>{e.exports=require("stream")},4404:e=>{e.exports=require("tls")},7310:e=>{e.exports=require("url")},9796:e=>{e.exports=require("zlib")},9735:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>m,originalPathname:()=>f,requestAsyncStorage:()=>d,routeModule:()=>p,serverHooks:()=>g,staticGenerationAsyncStorage:()=>l,staticGenerationBailout:()=>x});var s={};t.r(s),t.d(s,{GET:()=>GET,POST:()=>POST});var o=t(884),a=t(6132),i=t(5798),n=t(699),u=t(4598),c=t(5344);async function GET(e){try{let r=(0,n.j)(),{data:{user:t},error:s}=await r.auth.getUser();if(s||!t)return i.Z.json({error:{code:"UNAUTHORIZED",message:"Authentication required"}},{status:401});let{searchParams:o}=new URL(e.url),a=Object.fromEntries(o.entries()),p=c.Mb.parse(a),{data:d}=await r.from("user_profiles").select("role").eq("id",t.id).single();d?.role==="guest"&&(p.guest_id=t.id);let l=await u.s.getBookings(p);return i.Z.json({data:l})}catch(e){if(console.error("Error fetching bookings:",e),e instanceof Error)return i.Z.json({error:{code:"VALIDATION_ERROR",message:e.message}},{status:400});return i.Z.json({error:{code:"INTERNAL_ERROR",message:"Failed to fetch bookings"}},{status:500})}}async function POST(e){try{let r=(0,n.j)(),{data:{user:t},error:s}=await r.auth.getUser();if(s||!t)return i.Z.json({error:{code:"UNAUTHORIZED",message:"Authentication required"}},{status:401});let o=await e.json(),a=c.fw.parse(o),{data:p}=await r.from("properties").select("owner_id, is_active").eq("id",a.property_id).single();if(!p)return i.Z.json({error:{code:"NOT_FOUND",message:"Property not found"}},{status:404});if(!p.is_active)return i.Z.json({error:{code:"PROPERTY_INACTIVE",message:"Property is not available for booking"}},{status:400});let d=await u.s.createBooking(a,t.id);return i.Z.json({data:d},{status:201})}catch(e){if(console.error("Error creating booking:",e),e instanceof Error){if(e.message.includes("conflicts")||e.message.includes("exceeds"))return i.Z.json({error:{code:"BOOKING_CONFLICT",message:e.message}},{status:409});return i.Z.json({error:{code:"VALIDATION_ERROR",message:e.message}},{status:400})}return i.Z.json({error:{code:"INTERNAL_ERROR",message:"Failed to create booking"}},{status:500})}}let p=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/bookings/route",pathname:"/api/bookings",filename:"route",bundlePath:"app/api/bookings/route"},resolvedPagePath:"/Users/emmanuelbukenya/Projects/Medical Rentals/medical-rentals/app/api/bookings/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:d,staticGenerationAsyncStorage:l,serverHooks:g,headerHooks:m,staticGenerationBailout:x}=p,f="/api/bookings/route"}};var r=require("../../../webpack-runtime.js");r.C(e);var __webpack_exec__=e=>r(r.s=e),t=r.X(0,[657,736,465,652,937,344],()=>__webpack_exec__(9735));module.exports=t})();